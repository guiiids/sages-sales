<!DOCTYPE html>
<html>
<head>
    <title>Executive Dashboard</title>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        body { font-family: Arial, sans-serif; background: #fff; margin: 0; }
        .container { display: flex; flex-wrap: wrap; }
        .card { border-radius: 18px; color: #fff; margin: 20px; padding: 30px 40px; min-width: 500px; }
        .card.blue { background: linear-gradient(135deg, #0a3d62 0%, #0074d9 100%); }
        .card.gold { background: linear-gradient(135deg, #2d2d2d 0%, #fbb034 100%); }
        .section { display: flex;,gap: 32px; }
        .left { flex: 1; }
        .right { flex: 2; margin-left:30px; }
        .adoption { margin-bottom: 30px;, max-width: 95%; }
        .adoption-bar-bg { background: #e5e6eb; border-radius: 8px; height: 28px; width: 100%; margin: 8px 0; }
        .adoption-bar { height: 100%; border-radius: 8px; }
        .adoption-label { font-weight: bold; font-size: 1.2em; }
        .adoption-row { margin-bottom: 24px; max-width: 95%; }
        .metrics { display: flex; gap: 20px; margin-top: 30px; }
        .metric { border-radius: 12px; padding: 20px 30px; text-align: center; min-width: 120px; }
        .metric-label { color: #178a6b; font-weight: bold; }
        .metric-value { font-size: 2em; font-weight: bold; }
        .diff-pos { color: #1ca65a; }
        .diff-neg { color: #e74c3c; }
        .diff-neutral { color: #f1c40f; }
    </style>
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Roboto', 'sans-serif'],
                        condensed: ['Roboto Condensed', 'sans-serif'],
                    },
                    colors: {
                        agilent: { blue: '#0085D5', dark: '#0B3F63' }
                    }
                }
            }
        }
    </script>
</head>
<body>
<!-- Header -->
    <nav
        class="flex-none bg-white border-b border-slate-200 h-16 flex items-center justify-between px-6 sticky top-0 z-50">
        <div class="flex items-center gap-3">
            <svg class="h-5 text-agilent-blue" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2L14.4 9.6H22L15.8 14.1L18.2 21.7L12 17.2L5.8 21.7L8.2 14.1L2 9.6H9.6L12 2Z" />
            </svg>
            <span class="text-lg font-thin text-slate-800">SAGE <span
                    class="font-normal text-slate-400">Executive Overview</span></span>
        </div>
        <div class="flex items-center gap-4">
            <a href="/admin"
                class="text-sm font-condensed font-bold uppercase tracking-wide text-slate-500 hover:text-agilent-blue transition">
                <i class="ph ph-arrow-left mr-1"></i> Back to Hub
            </a>
        </div>
    </nav>

    <div class="container">
        <div class="left">
            <div class="card blue" id="total-enabled-users">
                <div>TOTAL ENABLED USERS</div>
                <div style="font-size:3em; font-weight:bold;">Loading...</div>
            </div>
            <div class="card blue" id="active-users">
                <div>ACTIVE USERS (90D)</div>
                <div style="font-size:3em; font-weight:bold;">Loading...</div>
                <div></div>
            </div>
            <div class="card gold" id="total-queries">
                <div>TOTAL QUERIES (90D)</div>
                <div style="font-size:3em; font-weight:bold;">Loading...</div>
                <div></div>
            </div>
        </div>
        <div class="right">
            <br/>
            <h2 style="color:#0a2940;">ADOPTION TIERS (TARGET VS ACTUAL)</h2>
            <div class="adoption" id="adoption-tiers">
                Loading...
            </div>
            <div class="metrics" id="metrics">
                Loading...
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const response = await fetch('/admin/executive-overview-data');
                const data = await response.json();

                // Populate Total Enabled Users
                document.querySelector('#total-enabled-users div:nth-child(2)').textContent = data.total_enabled_users;

                // Populate Active Users
                const activeUsersCard = document.querySelector('#active-users');
                activeUsersCard.querySelector('div:nth-child(2)').textContent = data.active_users;
                activeUsersCard.querySelector('div:nth-child(3)').innerHTML = `${data.active_users_pct} &bull; &#9650; ${data.active_users_mom} MoM`;

                // Populate Total Queries
                const totalQueriesCard = document.querySelector('#total-queries');
                totalQueriesCard.querySelector('div:nth-child(2)').textContent = data.total_queries;
                totalQueriesCard.querySelector('div:nth-child(3)').innerHTML = `&#9650; ${data.total_queries_mom} MoM`;

                // Populate Adoption Tiers
                const adoptionTiersContainer = document.querySelector('#adoption-tiers');
                adoptionTiersContainer.innerHTML = '';
                data.adoption_tiers.forEach(tier => {
                    const diff = tier.actual - tier.target;
                    const diffClass = diff > 0 ? 'diff-pos' : diff < 0 ? 'diff-neg' : 'diff-neutral';
                    adoptionTiersContainer.innerHTML += `
                        <div class="adoption-row">
                            <div class="adoption-label">${tier.name}</div>
                            <div class="adoption-bar-bg">
                                <div class="adoption-bar" style="width:${tier.actual}%; background:${tier.color};"></div>
                            </div>
                            <span style="font-weight:bold;">${tier.actual}%</span>
                            <span class="${diffClass}"> (${diff > 0 ? '+' : ''}${diff}%)</span>
                            &bull; Target: ${tier.target}%
                        </div>
                    `;
                });

                // Populate Metrics
                const metricsContainer = document.querySelector('#metrics');
                metricsContainer.innerHTML = '';
                data.metrics.forEach(metric => {
                    metricsContainer.innerHTML += `
                        <div class="metric" style="background:${metric.color}">
                            <div class="metric-label">${metric.label}</div>
                            <div class="metric-value">${metric.value}</div>
                        </div>
                    `;
                });
            } catch (error) {
                console.error('Error loading executive overview data:', error);
            }
        });
    </script>
</body>
</html>